{% extends "sboard/node_details.html" %}
{% load i18n %}
{% load sboard %}

{% block node_body %}
  <ul class="nav nav-tabs" id="result-tabs">
    {% for group in groups %}
    <li {% if forloop.first %}class="active"{% endif %}><a href="#{{ group.slug }}" data-toggle="tab">{{ group.title }}</a></li>
    {% endfor %}
  </ul>

  <div class="tab-content">
    {% for group in groups %}
    <div class="tab-pane {% if forloop.first %}active{% endif %}" id="{{ group.slug }}">
      {% if group.fraction_list %}
      <select id="filter-fraction">
        <option value="" selected>{% trans "Visos frakcijos" %}
        {% for fraction in group.fraction_list %}
        <option value="{{ fraction.slug }}">{{ fraction.title }}</option>
        {% endfor %}
      </select>
      {% endif %}

      <a class="help" href="#results-help" data-toggle="modal"></a>
      <table class="positive-negative">
        <tbody>
          <tr>
            <td class="positive-header" style="width: 50%">{% trans "ATITINKA JŪSŲ POZICIJĄ" %}</th>
            <td class="negative-header">{% trans "NEATITINKA JŪSŲ POZICIJOS" %}</th>
          </tr>
          <tr>
            {% for compatibility_list in group.compatibilities %}
            <td class="result-container">
              {% for compatibility in compatibility_list %}
              {% with compatibility.profile.ref.doc_type as doc_type %}
              <div class="result {% if not compatibility.precise %}imprecise{% endif %}
                          {{ doc_type|slugify }}
                          {% if doc_type == "MPProfile" %}fraction-{{ compatibility.profile.ref.fraction.ref.slug }}{% endif %}">
                <a href="{% nodeurl compatibility.profile.ref %}" title="Tikslumas: {{ compatibility.precision_percent }}%">
                  {% nodeimage compatibility.profile.ref 80 %}
                </a>
                <span class="result-description" title="Tikslumas: {{ compatibility.precision_percent }}%">
                  <p>
                    <span {% if doc_type == "Fraction" %}data-slug="{{ compatibility.profile.ref.slug }}"{% endif %}
                          class="{% if compatibility.positive %}positive{% else %}negative{% endif %} percent">{{ compatibility.compatibility_percent }}%</span>
                    {% if not compatibility.precise %}
                    <a class="help inline" href="#inactive-help" data-toggle="modal"></a>
                    {% endif %}
                  </p>
                  <p>
                    <a href="{% nodeurl compatibility.profile.ref %}">
                      {{ compatibility.profile.ref.title }}
                    </a>
                  </p>
                  <p class="sub-title">{{ compatibility.profile.ref.fraction_abbreviation|default:'' }}</p>
                </span>
              </div>
              {% endwith %}
              {% endfor %}
            </td>
            {% endfor %}
          </tr>
        <tbody>
      </table>
    </div>
    {% endfor %}
  </div>

  <div class="modal hide fade" id="results-help">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Pagalba</h3>
    </div>
    <div class="modal-body">
      <p>Testo rezultatai parodo, kiek frakcijos ar Seimo narių balsavimai Seime
      sutampa su jūsų atsakymais į klausimus-temas. Testo rezultatuose yra
      susumuojami visi atsakyti klausimai.</p>

      <p>Kiekvienas atsakymas nurodo, kiek jūsų pozicija sutampa su kiekvienos
      frakcijos ir Seimo nario pozicijomis, ir galutiniame rezultate jos yra
      sudedamos. "Tikrai taip/ne" atsakymams priskiriamas dvigubai didesnis
      svoris nei "taip/ne" atsakymams. Tikslesnę ir išsamesnę metodiką galite
      pažiūrėti "Kaip tai veikia" puslapyje.</p>
    </div>
  </div>

  <div class="modal hide fade" id="inactive-help">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Pagalba</h3>
    </div>
    <div class="modal-body">
      <p>Frakcijos ir Seimo nariai, dalyvavę mažiau nei 25% temos balsavimų, yra
      rodomi rezultatų apačioje, o dalyvavę mažiau nei 10% temos balsavimų,
      nėra rodomi rezultatuose. Taip padaryta dėl to, kad jų rezultatai gali
      neatspindėti jų tikrosios pozicijos.</p>

      <p>Balsavimuose būna didelių variacijų, todėl esant nedideliam balsavimų
      skaičiui, kyla rizika, kad atsitiktinis balsavimas iškreips rezultatus ir
      Seimo narį / frakciją nepelnytai "iškels" į rezultatų viršų. Tuo tarpu
      sudalyvavus daugiau balsavimų, išryškėja ilgalaikės, tvarios,
      patikimesnės tendencijos, tiksliau atspindinčios tikrąją jų poziciją
      temos atžvilgiu.</p>
    </div>
  </div>

{% endblock %}

{% block inlinejs %}
<script src="{{ STATIC_URL }}js/bootstrap-tab-history.js"></script>

<script type="text/javascript">
$(manoSeimas.activateFractionFilter);
</script>
{% endblock %}

{% block additional_sidebar %}
<ul class="nav nav-list">
  <li class="nav-header ">Aplankyk</li>
  <li>Ką žada kandidatai?</li>
  <li class="no-hover"><a href="http://manobalsas.lt"><img alt="Manobalsas.lt" src="{{ STATIC_URL }}img/manobalsas.png"></a></li>
</ul>
{% endblock %}
