{% extends "sboard/node_details.html" %}
{% load i18n %}
{% load sboard %}

{% block node_body %}
  {% if groups %}
  <ul class="nav nav-tabs" id="result-tabs">
    {% for group in groups %}
    <li {% if forloop.first %}class="active"{% endif %}><a href="#{{ group.slug }}" data-toggle="tab">{{ group.title }}</a></li>
    {% endfor %}
  </ul>

  <div class="tab-content">
    {% for group in groups %}
    <div class="tab-pane {% if forloop.first %}active{% endif %}" id="{{ group.slug }}">
      <a class="help" href="#results-help" data-toggle="modal"></a>
      <div class="facebook-right">
        <div class="fb-like" data-send="false" data-layout="button_count" data-href="http://manoseimas.lt"></div>
      </div>
      {% if group.fraction_list %}
      <select id="filter-fraction">
        <option value="" selected>{% trans "Visos frakcijos" %}
        {% for fraction in group.fraction_list %}
        <option value="{{ fraction.slug }}">{{ fraction.title }}</option>
        {% endfor %}
      </select>
      {% endif %}
      <table class="positive-negative">
        <tbody>
          <tr>
            <td class="positive-header" style="width: 50%">{% trans "ATITINKA JŪSŲ POZICIJĄ" %}</th>
            <td class="negative-header">{% trans "NEATITINKA JŪSŲ POZICIJOS" %}</th>
          </tr>
          <tr>
            {% for compatibility_list in group.compatibilities %}
            <td class="result-container">
              {% for compatibility in compatibility_list %}
              {% with compatibility.profile.doc_type as doc_type %}
              <div class="result {% if not compatibility.precise %}imprecise{% endif %}
                          {{ doc_type|slugify }}
                          {% if doc_type == "MPProfile" %}fraction-{{ compatibility.profile.fraction.ref.slug }}{% endif %}">
                <a href="{% nodeurl compatibility.profile %}" title="Tikslumas: {{ compatibility.precision_percent }}%">
                  {% nodeimage compatibility.profile 80 %}
                </a>
                <span class="result-description" title="Tikslumas: {{ compatibility.precision_percent }}%">
                  <p>
                    <span {% if doc_type == "Fraction" %}data-slug="{{ compatibility.profile.slug }}"{% endif %}
                          class="{% if compatibility.positive %}positive{% else %}negative{% endif %} percent">{{ compatibility.compatibility_percent }}%</span>
                    {% if not compatibility.precise %}
                    <a class="help inline" href="#inactive-help" data-toggle="modal"></a>
                    {% endif %}
                  </p>
                  <p>
                    <a href="{% nodeurl compatibility.profile %}">
                      {{ compatibility.profile.title }}
                    </a>
                  </p>
                  <p class="sub-title">{{ compatibility.profile.fraction_abbreviation|default:'' }}</p>
                </span>
              </div>
              {% endwith %}
              {% endfor %}
            </td>
            {% endfor %}
          </tr>
        <tbody>
      </table>
    </div>
    {% endfor %}
  </div>

  <div class="modal hide fade" id="results-help">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Pagalba</h3>
    </div>
    <div class="modal-body">
      <p>Testo rezultatai parodo, kiek jūsų atsakymai į klausimus sutampa su
      frakcijų/Seimo narių pozicijomis, apskaičiuojamomis pagal Seime
      vykusius balsavimus.</p>

      <p>Seimo narių ir frakcijų pozicija yra lyginama su jūsų atsakymais, o
      procentais parodoma, kiek jos sutampa. Jei pažymėjote "Man tai svarbu",
      jūsų pozicija pažymima kaip dvigubai svarbesnė nei atsakant nepažymėjus
      šio pasirinkimo. Skaičiuojami tik atsakyti klausimai, todėl testo
      rezultatai bus tikslesni, jei atsakysite į kuo daugiau klausimų. Daugiau
      apie skaičiavimą <a href="/kaip-tai-veikia/">čia</a>.</p>

      <p><em>Pavyzdžiui, atsakėte "taip" į du klausimus ir gavote, kad jūsų
        atsakymai sutampa su frakcijos "X" pozicija 20% ir 70%. Tada testo
        rezultate ši frakcija turės (20+70)/2 = 45% atitikimą su jūsų pozicija.
        Tačiau jei atsakėte "tikrai taip" ir "taip", tada rezultate atitikimas
        bus (20*2+70*1)/3 = 37%. Jei atsakėte "tikrai ne" ir "taip", tada
        rezultatas bus (20*(-2)+70*1)/3 = 10%.</em></p>
    </div>
  </div>

  {% include "partials/inactive_help.html" %}
  {% else %}
  <p>Jeigu norite sužinoti savo testo rezultatus, atsakykite bent į vieną
  klausimą <a href="{% nodeurl node %}">testo puslapyje</a>.</p>
  {% endif %}
{% endblock %}

{% block inlinejs %}
<script src="{{ STATIC_URL }}js/bootstrap-tab-history.js"></script>

<script type="text/javascript">
$(manoSeimas.activateFractionFilter);
</script>
{% endblock %}

{% block additional_sidebar %}
<ul class="nav nav-list">
  <li class="nav-header ">Aplankyk</li>
  <li>Ką žada kandidatai?</li>
  <li class="no-hover"><a href="http://manobalsas.lt"><img alt="Manobalsas.lt" src="{{ STATIC_URL }}img/manobalsas.png"></a></li>
</ul>
{% endblock %}
