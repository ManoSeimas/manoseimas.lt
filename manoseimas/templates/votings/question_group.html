{% extends "sboard/base.html" %}
{% load i18n %}
{% load sboard %}

{% block title %}
  {% if node %}
    {% if not node.title and node.has_parent %}
      <a href="{{ node.get_parent.permalink }}">
        {{ node.get_parent.title }}
      </a>
    {% else %}
      {{ node.title }}
    {% endif %}
  {% else %}
    {% trans "All nodes" %}
  {% endif %}
{% endblock %}


{% block content %}
  <div class="test-header">
    <button class="btn btn-success btn-large">Rodyti rezultatus</button>
    <h2>Atsakyk į tau rūpimus klausimus ir atrask panašiai dirbančius
      seimo narius</h2>
  </div>



  {% if children %}
  <div id="test-questions" class="test-questions">
    {% for q in children %}
    <div class="accordion-group test-question">
      <a href="#{{ q.key }}"
         data-toggle="collapse" data-parent="#test-questions"
         class="btn btn-mini btn-success pull-right">
        mano nuomonė <span class="caret"></span></a>
      <h3><a href="{{ q.permalink }}">{{ q.title }}</a></h3>
      <p>{{ q.get_body }}</p>
      <div id="{{ q.key }}" class="collapse">

        <table class="solution-issues">
          <tbody>
            <tr class="solution-issue-title">
              <td>
                <div class="item-box">
                  <img src="{{ STATIC_URL }}img/smile-happy.png" />
                </div>
                <div class="item-content">
                  <h2 class="solves">{% trans "Sprendžia problemas" %}</h2>
                </div>
              </td>
              <td>
                <div class="item-box">
                  <img src="{{ STATIC_URL }}img/smile-sad.png" />
                </div>
                <div class="item-content">
                  <h2 class="raises">{% trans "Sukelia problemas" %}</h2>
                </div>
              </td>
            </tr>
            {% for issue in q.issues %}
            <tr>
              {% for solissue in issue %}
              <td>
                {% if solissue %}
                <div class="item-box">{{ solissue.likes }}</div>
                <div class="item-content">
                  <h2><a href="{{ solissue.permalink }}">{{ solissue.issue.ref.title }}</a></h2>
                  <p>{{ solissue.summary }}</p>
                </div>
                {% endif %}
              </td>
              {% endfor %}
            </tr>
            {% endfor %}
            <tr class="actions">
              <td colspan="2">
                <div class="btn-group" data-toggle="buttons-radio">
                  <button class="btn btn-success">{% trans "Tikrai taip" %}</button>
                  <button class="btn btn-success">{% trans "Taip" %}</button>
                  <button class="btn btn-success">{% trans "Ne" %}</button>
                  <button class="btn btn-success">{% trans "Tikrai ne" %}</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>


      </div>
    </div>
    <hr />
    {% endfor %}
  </div>
  {% else %}
  <p>{% trans "Šiai kategorijai nepriskirtas nei vienas sprendimas." %}</p>
  {% endif %}

{% endblock %}


{% block inlinejs %}
<script type="text/javascript">
function submitQuestion(n, node_slug, last, vote) {
    var url = "/" + node_slug + "/quick-results/?vote=" + vote;

    jQuery.getJSON(url, function(data) {
        if (last) {
            window.location.href = "{% nodeurl node 'results' %}";
        }
        else {
            updateSideResult(data);
        }
    });

    if (!last) {
        updateTabs(n);
    }
};

function updateTabs(n) {
      n++;
      $(".tab-pane").removeClass("active");
      $(".qpill").removeClass("active");
      $("#q" + n).addClass("active");
      $("#qpill" + n).addClass("active");
}

function updateSideResult(data) {
    var div = document.getElementById("side-result");
    var html = [];

    html.push('<table class="table table-condensed"><tbody>');
    data.mps.map(function(mp) {
        html.push('<tr>');
        html.push('<td><img src="', mp.url, '" title="', mp.name, '" style="height: 56px;"></td>');
        html.push('<td><b>', mp.name, '</b><br>');
        html.push('<div class="progress progress-success"><div class="bar" style="width: ', mp.score, '%;"> ', mp.score, '%</div></div></td>');
        html.push('</tr>');
    });
    html.push('</tbody></table>');

    jQuery(div).html(html.join(""));
};


</script>
{% endblock %}
