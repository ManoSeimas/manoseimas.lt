{% extends "sboard/base.html" %}
{% load i18n %}
{% load sboard %}

{% block title %}
  {% if node %}
    {% if not node.title and node.has_parent %}
      <a href="{{ node.get_parent.permalink }}">
        {{ node.get_parent.title }}
      </a>
    {% else %}
      {{ node.title }}
    {% endif %}
  {% else %}
    {% trans "All nodes" %}
  {% endif %}
{% endblock %}


{% block content %}
  {% for category in categories %}
  <h1 class="header-bar" id="{{ category.slug }}">{{ category.title|upper }}</h1>

  {% if category.positions %}
  <div class="test-questions">
    {% for q, position in category.positions %}
    <div id="{{ q.key }}" class="accordion-group test-question">
      <h2 class="inline-header"><a href="{{ q.permalink }}">{{ q.title }}</a></h2>
      <div id="{{ q.key }}-summary">
        <p>{{ q.summary }}</p>
      </div>
      <div id="{{ q.key }}-result"></div>
      <div class="btn-toolbar answers">
        <div class="btn-group position-buttons" data-toggle="buttons-radio">
          {% for value, label in buttons %}
          <button class="btn btn-primary{% if value == position %} active{% endif %}"
                  data-value="{{ value }}">
            {{ label|upper }}
          </button>
          {% endfor %}
        </div>
        <div class="btn-group">
          <a href="#{{ q.key }}-details"
             data-toggle="collapse" data-parent="#test-questions"
             class="btn">
            ARGUMENTAI <span class="caret"></span></a>
        </div>
      </div>
      <div id="{{ q.key }}-details"class="collapse solution-details">
        <table class="solution-issues">
          <tbody>
            <tr class="solution-issue-title">
              <td>
                <div class="item-content">
                  <h2 class="solves">{% trans "UŽ" %}</h2>
                </div>
              </td>
              <td>
                <div class="item-content">
                  <h2 class="raises">{% trans "PRIEŠ" %}</h2>
                </div>
              </td>
            </tr>
            {% for issue in q.issues %}
            <tr>
              {% for solissue in issue %}
              <td>
                {% if solissue %}
                <div class="item-box">{{ solissue.likes }}</div>
                <div class="item-content">
                  <h2><a href="{{ solissue.permalink }}">{{ solissue.issue.ref.title }}</a></h2>
                  <p>{{ solissue.summary }}</p>
                </div>
                {% endif %}
              </td>
              {% endfor %}
            </tr>
            {% empty %}
            <tr><td class="empty" colspan="2"><p>Nėra argumentų</p></td></tr>
            {% endfor %}
          </tbody>
        </table>


      </div>
    </div>

    {% if not forloop.last %}
    <hr>
    {% endif %}
    {% endfor %}
  </div>

  {% else %}
  <p>{% trans "Šiai kategorijai nepriskirtas nei vienas sprendimas." %}</p>
  {% endif %}
  {% endfor %}

  <div class="bar" style="margin-bottom: -21px">
    <a href="{% nodeurl node 'rezultatai' %}" class="btn btn-success btn-large">
      {% trans "RODYTI REZULTATUS" %}
    </a>
  </div>

{% endblock %}


{% block inlinejs %}
<script type="text/javascript">
function submitPosition(node_id, position) {
    var url = "{% nodeurl node 'submit-position' %}";
    var postData = {
            node: "+" + node_id,
            position: position
        };
    $.post(url, postData, function(result) {
        $("#" + node_id + "-result").html(result);
    }, 'html');
};

$(function() {
    $(".position-buttons > button").click(function() {
        var btn = $(this);
        var node = btn.parentsUntil('.test-question').parent().attr('id');
        var position = btn.attr('data-value');
        submitPosition(node, position);
    });
});

</script>
{% endblock %}
