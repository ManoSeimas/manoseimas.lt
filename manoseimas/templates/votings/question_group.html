{% extends "sboard/base.html" %}
{% load i18n %}
{% load sboard %}

{% block title %}
  {% if node %}
    {% if not node.title and node.has_parent %}
      <a href="{{ node.get_parent.permalink }}">
        {{ node.get_parent.title }}
      </a>
    {% else %}
      {{ node.title }}
    {% endif %}
  {% else %}
    {% trans "All nodes" %}
  {% endif %}
{% endblock %}


{% block content %}
  {{ node.render_body }}

  {% for category in categories %}
  <div class="section">
    <h1 id="{{ category.slug }}">{{ category.title|upper }}</h1>

    {% if category.positions %}
    <div class="test-questions">
      {% for q, position in category.positions %}
      <div id="{{ q.key }}" class="accordion-group test-question">
        <h2 class="inline-header arrow-after"><a href="{{ q.permalink }}">{{ q.title }}</a></h2>
        <div id="{{ q.key }}-summary">
          <p>{{ q.summary }}</p>
        </div>
        <div class="compat-preview" id="{{ q.key }}-result"></div>
        <div class="btn-toolbar answers">
          <div class="btn-group position-buttons" data-toggle="buttons-radio">
            {% for value, label in buttons %}
            <button class="btn{% if value == position %} active{% endif %}"
                    data-value="{{ value }}">
              {{ label|upper }}
            </button>
            {% endfor %}
          </div>
          <div class="btn-group">
            <a href="#{{ q.key }}-details"
               data-toggle="collapse" data-parent="#test-questions"
               class="btn">
              ARGUMENTAI <span class="caret"></span></a>
          </div>
        </div>
        <div id="{{ q.key }}-details"class="collapse solution-details">
          <table class="positive-negative">
            <tbody>
              <tr>
                <td class="positive-header">
                  <h2>{% trans "UŽ" %}</h2>
                </td>
                <td class="negative-header">
                  <h2>{% trans "PRIEŠ" %}</h2>
                </td>
              </tr>
              {% for aye_against in q.short_arguments %}
              <tr>
                {% for argument in aye_against %}
                <td>
                  {% if argument %}
                  <h2><a href="{{ argument.permalink }}">{{ argument.issue.ref.title }}</a></h2>
                  <p>{{ argument.summary }}</p>
                  {% endif %}
                </td>
                {% endfor %}
              </tr>
              {% empty %}
              <tr><td class="empty" colspan="2"><p>Nėra argumentų</p></td></tr>
              {% endfor %}
              {% if q.more_arguments %}
              <tr><td class="empty" colspan="2"><a href="{{ q.permalink }}#argumentai">Daugiau argumentų</a></td></tr>
              {% endif %}
            </tbody>
          </table>


        </div>
      </div>

      {% if not forloop.last %}
      <hr>
      {% endif %}
      {% endfor %}
    </div>

    {% else %}
    <p>{% trans "Šiai kategorijai nepriskirtas nei vienas sprendimas." %}</p>
    {% endif %}
  </div>
  {% endfor %}

  <div class="bar" style="margin-bottom: -21px">
    <a href="{% nodeurl node 'rezultatai' %}" class="btn btn-show-results">
      {% trans "BAIGTI TESTĄ" %}
    </a>
  </div>

  <div class="modal hide fade" id="preview-help">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3>Pagalba</h3>
    </div>
    <div class="modal-body">
      <p>Žali ir raudoni procentai parodo, kiek frakcijos narių balsavimai dėl temos
      Seime sutampa su jūsų atsakymu į klausimą-temą. Balsavimų rezultatai yra
      gaunami iš temai priskirtų balsavimų, kuriuos galite pažiūrėti temos
      profilyje.</p>

      <p>Kiekvieno frakcijos nario balsavimų rezultatai yra įvertinami
      (<strong>už</strong> = 2, <strong>prieš</strong> = -2,
      <strong>susilaikė/nebalsavo</strong> = -1) ir susumuojami su kitų frakcijos
      narių balsavimais, o tada padalinami iš maksimalaus įmanomo taškų skaičiaus
      (t.y. jei visi balsavimai būtų "už"). Taip gaunama frakcijos pozicija temos
      atžvilgiu tarp 100% ir -100%, kuri tuomet yra palyginama su jūsų atsakymu.
      Išsamią metodiką galite pažiūrėti "Kaip tai veikia" puslapyje.</p>
    </div>
  </div>

{% endblock %}


{% block inlinejs %}
<script type="text/javascript">
$(function() {
  $(".position-buttons > button").click(function() {
    var btn = $(this);
    var node = btn.parentsUntil('.test-question').parent().attr('id');
    var position = btn.attr('data-value');
    var url = "{% nodeurl node 'submit-position' %}";
    manoSeimas.submitPosition(url, node, position, function(result) {
      $('.compat-preview').hide()
      $("#" + node + "-result").html(result).show();
    });
  });
});

$(function() {
  var $firstHeading = $('h1:first')
  $(window).scrollspy({ offset: $firstHeading.offset().top + 1 });
});
</script>
{% endblock %}

{% block additional_sidebar %}
<a href="{% nodeurl node 'rezultatai' %}" class="btn btn-show-results">
  {% trans "BAIGTI TESTĄ" %}
</a>
{% endblock %}
